{% extends "winedora/base_html5.html" %}

{% block additional_styles %}
  <style type="text/css">
    .control-group .text-label, h2 {
      margin-top: -4px;
    }
    .text-label {
      text-align: right;
      font-weight: 900;
      text-transform: capitalize;
    }
    .text-content {
      display:table-cell; 
      vertical-align:middle;
    }
    .form-row {
      margin-bottom: 12px;
    }
  </style>
{% endblock additional_styles %}

{% block header %}
  <h1 class="headline">Get The Party Started</h1>
{% endblock header %}

{% block content %}
    {% if not party.requested %}
    <div class="menu_wrap main partycrumb">
      <ul class="nav">
        <li class="party-add">&nbsp;</li>
        <li class="party-write-invitation active">&nbsp;</li>
        <li class="party-invite-friends">&nbsp;</li>
      </ul>
    </div>
    {% endif %}

    {{ form.errors }}
    <div class="container" data-spy="scroll" data-offset="50" data-target=".subnav">
      <!-- <section id="customize-invitation"> -->

        <form class="form-horizontal" method="POST" action="{{ app_path }}">
          {% csrf_token %}
          <!-- <hr /> -->
           <div class="control-group">
            <div class="control-label text-label"><h2>Invite Email</h2></div>
          </div>
          
          {{ form.party }}
           <div class="control-group">
            <div class="control-label text-label">From</div>
            <div class="controls">
              <p>{{ party.host.first_name }} {{ party.host.last_name }} (<i>Note: The email will be sent from {{ party.host.email }}</i>)</p>
            </div>
          </div>
          <div class="control-group">
            <div class="control-label text-label">Email subject</div>
            <div class="controls">
              {{ form.custom_subject }}
              {% if form.custom_subject.errors %}
                <span class="help-inline">
                  {{ form.custom_subject.errors }}
                </span>
              {% endif %}
            </div>
          </div>

          <div class="control-group">
            <div class="control-label text-label">Message</div>
            <div class="controls">
              {{ form.custom_message }}
            </div>
          </div>
          <hr />
          <div class="control-group">
            <div class="control-label text-label"><h2>Party Info</h2></div>
            <div class="controls" style="padding-top: 11px;">
              {% if not party.requested %}
                <a href="{% url party_add party.id %}">Edit</a>
              {% endif %}
            </div>
          </div>

          <div class="control-group">
            <div class="control-label text-label">Date/Time</div>
            <div class="controls">
              <p>{{ party.event_date|date:"F j, o" }} at {{ party.event_date|date:"g:i A" }}</p>
            </div>
          </div>
          <div class="control-group">
            <div class="control-label text-label">Party Name</div>
            <div class="controls">
              {{ party.title }}
            </div>
          </div>
          <div class="control-group">
            <div class="control-label text-label">Location</div>
            <div class="controls">
              <p>{{ party.address.street1 }}</p>
              <p>{{ party.address.street2 }}</p>
              <p>{{ party.address.city }}, {{ party.address.state }} {{ party.address.zipcode}}</p>
            </div>
          </div>
          {% if not party.confirmed %}
            <hr />
            <div class="control-group">
              <div class="control-label text-label"><h2>Invite Options</h2></div>
              <div class="controls" style="padding-top: 11px;">
                <p>Do you want vinely to?</p>
                <hr />
                <!-- {{ form.invite_options }} -->
                <div class="row">
                  <div class="span4">
                    <label>
                      <input type="radio" name="auto_invite" value="0" {% if party.auto_invite %}checked="checked"{% endif %} /> 
                      send out the party invite automatically as soon as your Pro confirms the time and date?
                    </label>
                  </div>
                  <div class="span1 center"><h2>OR</h2></div>
                  <div class="span4">
                    <label>
                      <input type="radio" name="auto_invite" value="1" {% if not party.auto_invite %}checked="checked"{% endif %} /> 
                      allow you to confirm your invite email again before it is sent out?
                    </label>
                  </div>
                </div>
                <div class="row">
                  <div class="span4">
                    <label>
                      <input type="radio" name="auto_thank_you" value="0" {% if party.auto_thank_you %}checked="checked"{% endif %} /> 
                      send out a Thank You email on your behalf automatically after the party? 
                      (<a href="#">Preview Email</a>)
                    </label>
                  </div>
                  <div class="span1 center"><h2>OR</h2></div>
                  <div class="span4">
                    <label>
                      <input type="radio" name="auto_thank_you" value="1" {% if not party.auto_thank_you %}checked="checked"{% endif %} /> 
                      let me send my own Thank You email after the party
                    </label>
                  </div>
                </div>
                <hr />
                <div class="row">
                  <div class="span10">
                    <label>
                      <input type="checkbox" name="guests_can_invite" value="1" {% if party.guests_can_invite %}checked="checked"{% endif %} /> 
                      allow guests to invite friends?
                    </label>
                  </div>
                </div>
                <!-- <hr /> -->
                <div class="vertical-space"></div>
                {% if not party.requested %}
                  <div class="row">
                    <div class="span10">
                      <p><i>Note: We will notify your Pro of the party request once you complete the setup. 
                        The Pro will then need to confirm the date and time before your party invite is sent out.
                        See Invite Options section above for preferences on when we should deliver your invite.</i>
                      </p>
                    </div>
                  </div>
                {% endif %}
              </div>
            </div>
          {% endif %}
          {% if not party.requested %}
            <div class="row">
              <div class="span1">&nbsp;</div>
              <div class="span7">
                <a href="{% url party_add party.id %}" class="btn btn-primary">Back</a>
                <button class="btn btn-primary commit" name="save" value="save">Save</button>
              </div>
              <div class="span4">
                <a href="javascript:;" class="btn btn-primary">Preview Invite</a>
                <button class="btn btn-primary commit" name="next" value="next">Next</button>
              </div>
            </div>
          {% else %}
            <div class="control-group">
              <div class="control-label">&nbsp;</div>
              <div class="controls">
                <a href="javascript:;" class="btn btn-primary">Preview Invite</a>
                <button class="btn btn-primary commit" name="save" value="save">Save</button>
              </div>
            </div>
          {% endif %}
        </form>
      <!-- </section> -->

    </div>

{% endblock content %}

{% block additional_scripts %}
  <script type="text/javascript">
    var original_form;
    var saved = false;
    $(document).ready(function() {
      original_form = $('.form-horizontal').serialize();
      // $('#id_custom_message').autogrow();

      $('.commit').click(function() {
        saved = true;
      });
    });

    $(window).bind('beforeunload', function(e) {
      // TODO: figure out how to check if its a save pressed
      if ($('.form-horizontal').serialize() != original_form && saved == false) {
        return 'You are about to leave this page even though you have made changes to your invite.';
      }
    });
  </script>
{% endblock additional_scripts %}